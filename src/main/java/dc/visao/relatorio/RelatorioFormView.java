package dc.visao.relatorio;

import org.vaadin.easyuploads.FileBuffer;
import org.vaadin.easyuploads.UploadField;
import org.vaadin.easyuploads.UploadField.FieldType;

import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.GridLayout;
import com.vaadin.ui.TextField;
import com.vaadin.ui.Upload;

import dc.entidade.framework.FmMenu;
import dc.entidade.relatorio.Relatorio;
import dc.entidade.relatorio.TipoRelatorio;
import dc.visao.framework.component.manytoonecombo.ManyToOneCombo;
import dc.visao.framework.util.ComponentUtil;

public class RelatorioFormView extends CustomComponent {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	@AutoGenerated
	private GridLayout mainLayout;

	private TextField txNome;
	private TextField txDescricao;
	private TextField txTelaParametros;
	private UploadField relatorioUpload;
	private String nomeRelatorio;
	private ComboBox cbTipos;

	private ManyToOneCombo<FmMenu> comboMenus;

	public RelatorioFormView() {
		buildMainLayout();
		setCompositionRoot(mainLayout);
		configuraComponentes();
	}

	@AutoGenerated
	private GridLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new GridLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(true);
		mainLayout.setSpacing(true);
		mainLayout.setRows(6);
		mainLayout.setColumns(1);

		// top-level component properties
		setWidth("100.0%");
		setHeight("-1px");

		txNome = ComponentUtil.buildTextField("Nome");
		mainLayout.addComponent(txNome, 0, 0);

		txDescricao = ComponentUtil.buildTextField("Descrição");
		mainLayout.addComponent(txDescricao, 0, 1);

		cbTipos = ComponentUtil.buildComboBox("Tipo Relatório");
		cbTipos.addItem(TipoRelatorio.LISTAGEM);
		cbTipos.addItem(TipoRelatorio.FORMULARIO);
		mainLayout.addComponent(cbTipos, 0, 2);

		txTelaParametros = ComponentUtil.buildTextField("Tela de parâmetros");
		mainLayout.addComponent(txTelaParametros, 0, 3);

		relatorioUpload = new UploadField();
		relatorioUpload.setCaption("Relatório");
		relatorioUpload.setImmediate(false);
		mainLayout.addComponent(relatorioUpload, 0, 4);

		comboMenus = new ManyToOneCombo<FmMenu>();
		comboMenus.setCaption("Menu");
		comboMenus.setSizeFull();
		mainLayout.addComponent(comboMenus, 0, 5);

		return mainLayout;
	}

	public void preencheBean(Relatorio currentBean) {
		currentBean.setNome(txNome.getValue());
		currentBean.setDescricao(txDescricao.getValue());
		currentBean.setTipo(((TipoRelatorio) cbTipos.getValue()).getTipo());
		currentBean.setMenu(comboMenus.getValue());
		currentBean.setTelaParametros(txTelaParametros.getValue());
	}

	public void preencheForm(Relatorio currentBean) {
		txNome.setValue(currentBean.getNome());
		txDescricao.setValue(currentBean.getDescricao());
		comboMenus.setValue(currentBean.getMenu());
		cbTipos.setValue(TipoRelatorio.getEnum(currentBean.getTipo()));
		txTelaParametros.setValue(currentBean.getTelaParametros());
	}

	public TextField getTxNome() {
		return txNome;
	}

	public void setTxNome(TextField txNome) {
		this.txNome = txNome;
	}

	public TextField getTxDescricao() {
		return txDescricao;
	}

	public void setTxDescricao(TextField txDescricao) {
		this.txDescricao = txDescricao;
	}

	@SuppressWarnings("serial")
	private void configuraComponentes() {

		relatorioUpload.setFieldType(FieldType.FILE);
		relatorioUpload.addListener(new ValueChangeListener() {

			@Override
			public void valueChange(com.vaadin.data.Property.ValueChangeEvent event) {
				UploadField upload = (UploadField) event.getProperty();
				Upload up = (Upload) upload.getRootLayout().getComponent(0);
				nomeRelatorio = ((FileBuffer) up.getReceiver()).getLastFileName();

			}
		});

	}

	public UploadField getRelatorioUpload() {
		return relatorioUpload;
	}

	public void setRelatorioUpload(UploadField relatorioUpload) {
		this.relatorioUpload = relatorioUpload;
	}

	public String getNomeRelatorio() {
		return nomeRelatorio;
	}

	public void setNomeRelatorio(String nomeRelatorio) {
		this.nomeRelatorio = nomeRelatorio;
	}

	public ManyToOneCombo<FmMenu> getComboMenus() {
		return comboMenus;
	}

	public void setComboMenus(ManyToOneCombo<FmMenu> comboMenus) {
		this.comboMenus = comboMenus;
	}

	public TextField getTxTelaParametros() {
		return txTelaParametros;
	}

	public void setTxTelaParametros(TextField txTelaParametros) {
		this.txTelaParametros = txTelaParametros;
	}

	public ComboBox getCbTipos() {
		return cbTipos;
	}

	public void setCbTipos(ComboBox cbTipos) {
		this.cbTipos = cbTipos;
	}

}